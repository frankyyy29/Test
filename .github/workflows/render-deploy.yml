name: Deploy to Render

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Deploy Backend to Render
      env:
        RENDER_API_KEY: ${{ secrets.RENDER_API_KEY }}
        RENDER_BACKEND_SERVICE_ID: ${{ secrets.RENDER_BACKEND_SERVICE_ID }}
      run: |
        if [ -z "$RENDER_BACKEND_SERVICE_ID" ]; then
          echo "‚ö†Ô∏è  RENDER_BACKEND_SERVICE_ID not set"
          echo "Setup: https://github.com/frankyyy29/Test/settings/secrets/actions"
          echo "To get service ID: https://dashboard.render.com ‚Üí select service ‚Üí copy from URL"
        else
          echo "üöÄ Deploying backend..."
          curl -X POST https://api.render.com/v1/services/$RENDER_BACKEND_SERVICE_ID/deploys \
            -H "Authorization: Bearer $RENDER_API_KEY" \
            -H "Content-Type: application/json" \
            -d '{}'
          echo "‚úÖ Backend deployment triggered"
        fi

    - name: Deploy Frontend to Render
      env:
        RENDER_API_KEY: ${{ secrets.RENDER_API_KEY }}
        RENDER_FRONTEND_SERVICE_ID: ${{ secrets.RENDER_FRONTEND_SERVICE_ID }}
      run: |
        if [ -z "$RENDER_FRONTEND_SERVICE_ID" ]; then
          echo "‚ö†Ô∏è  RENDER_FRONTEND_SERVICE_ID not set"
          echo "Setup: https://github.com/frankyyy29/Test/settings/secrets/actions"
          echo "To get service ID: https://dashboard.render.com ‚Üí select service ‚Üí copy from URL"
        else
          echo "üöÄ Deploying frontend..."
          curl -X POST https://api.render.com/v1/services/$RENDER_FRONTEND_SERVICE_ID/deploys \
            -H "Authorization: Bearer $RENDER_API_KEY" \
            -H "Content-Type: application/json" \
            -d '{}'
          echo "‚úÖ Frontend deployment triggered"
        fi
